{% extends "main.html" %}
{% load get_device_count_notifications %}

{% block css %}
    {{ block.super }}
    <link href="{{ STATIC_URL }}css/list.css" rel="stylesheet">
{#    <link href="{{ STATIC_URL }}css/positions_list.css" rel="stylesheet">#}
{% endblock %}

{#{% block js %}#}
{#    {{ block.super }}#}
{#    <script src="{{ STATIC_URL }}js/positions_list.js"></script>#}
{#{% endblock %}#}


{% block sub_content%}
    {% if notifications_list %}
{#    <a class="btn btn-primary btn-large pull-right" href="{% url 'export_positions' device.id %}">Экспорт <i class="icon-download-alt"></i></a>#}
    <h1>Количество инцидентов {{ rule.device.title }}</h1>
    <dl class="dl-horizontal">
        <dt>Гео-зона</dt><dd>{% get_device_count_notifications rule.device 1 %}</dd>
        <dt>Начало движения</dt><dd>{% get_device_count_notifications rule.device 2 %}</dd>
        <dt>Макс. скорость</dt><dd>{% get_device_count_notifications rule.device 3 %}</dd>
        <dt>Пропала связь</dt><dd>{% get_device_count_notifications rule.device 4 %}</dd>
    </dl>
    <h1>Список инцидентов</h1>
    <table class="table table-striped table-condensed vertical-middle">
    <thead>
    <tr>
        <th>Дата</th>
        <th>Тип</th>
        <th>Отправлено email</th>
        <th>Обработано email</th>
        <th>Отправлено SMS</th>
        <th>Обработано SMS</th>
    </thead>
    <tbody>
    {% for notification in notifications_list %}
        <tr>
            <td>{{ notification.created_at|date:'Y-m-d H:i:s' }}</td>
            <td>{{ notification.rule.get_rule_type_title }}</td>
            <td>{% if notification.email_send_at %}{{ notification.email_send_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</td>
            <td>{% if notification.email_processed_at %}{{ notification.email_processed_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</td>
            <td>{% if notification.sms_send_at %}{{ notification.sms_send_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</td>
            <td>{% if notification.sms_processed_at %}{{ notification.sms_processed_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    {% if is_paginated %}
    <div class="pagination">
        <a {% if not page_obj.has_previous %}class="disabled"{% endif %} href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}javascript:void(0);{% endif %}">&larr; Назад</a>
        <a {% if not page_obj.has_next %}class="disabled"{% endif %} href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}javascript:void(0);{% endif %}">Вперед &rarr;</a>
        <span class="page-current pull-right">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
    </div>
    {% endif %}
{% else %}
    <h1>Инцидентов для {{ rule.device.title }} нет</h1>
{% endif %}
{% endblock %}