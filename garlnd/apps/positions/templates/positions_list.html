{% extends "main.html" %}

{% block css %}
    {{ block.super }}
    <link href="{{ STATIC_URL }}css/list.css" rel="stylesheet">
    <link href="{{ STATIC_URL }}css/positions_list.css" rel="stylesheet">
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/positions_list.js"></script>
{% endblock %}


{% block sub_content%}
    {% if positions_list %}
    <a class="btn btn-primary btn-large pull-right" href="{% url 'export_positions' device.id %}">Экспорт <i class="icon-download-alt"></i></a>
    <h1>Статистика {{ device.title }}</h1>
    <dl class="dl-horizontal">
        <dt>Количество точек</dt><dd>{{ device.get_device_positions_count }}</dd>
        <dt>Полное время</dt><dd>{{ device.get_full_time }}</dd>
        <dt>Расстояние</dt><dd>{{ device.get_full_distance|floatformat:3 }} км</dd>
        <dt>Средняя скорость</dt><dd>{{ device.get_average_speed|floatformat:2 }} км/ч</dd>
    </dl>
    <h1>Список путевых точек</h1>
    <table class="table table-striped table-condensed vertical-middle">
    <thead>
    <tr>
        <th>Дата</th>
        <th>Время (с)</th>
        <th>Долгота</th>
        <th>Широта</th>
        <th>Расстояние (км)</th>
        <th>Скорость (км/ч)</th>
        <th>Ускорение (м/с<sup>2</sup>)</th>
        <th>Операции</th>
    </thead>
    <tbody>
    {% for position in positions_list %}
        <tr{% if position.is_broken %} class="is_broken error"{% endif %} data-id="{{ position.id }}">
            <td>{{ position.created_at|date:'Y-m-d H:i:s' }}</td>
            <td>{{ position.duration }}</td>
            <td>{{ position.longitude|floatformat:6 }}</td>
            <td>{{ position.latitude|floatformat:6 }}</td>
            <td>{{ position.distance|floatformat:3 }}</td>
            <td>{{ position.get_speed|floatformat:2 }}</td>
            <td>{{ position.acceleration|floatformat:2 }}</td>
            <td>
                <input type="button" data-url="{% url 'status_position' position.id %}" class="btn btn-sm status" title="Изменить статус точки" value="{% if position.is_broken %}Восстановить{% else %}Исключить{% endif %}">
            </td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    {% if is_paginated %}
    <div class="pagination">
        <a {% if not page_obj.has_previous %}class="disabled"{% endif %} href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}javascript:void(0);{% endif %}">&larr; Назад</a>
        <a {% if not page_obj.has_next %}class="disabled"{% endif %} href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}javascript:void(0);{% endif %}">Вперед &rarr;</a>
        <span class="page-current pull-right">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
    </div>
    {% endif %}
{% else %}
    <h1>Путевых точек для {{ device.title }} нет</h1>
{% endif %}
{% endblock %}