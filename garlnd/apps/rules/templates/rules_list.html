{% extends "main.html" %}

{% block css %}
    {{ block.super }}
    <link href="{{ STATIC_URL }}css/list.css" rel="stylesheet">
    <link href="{{ STATIC_URL }}css/rules_list.css" rel="stylesheet">
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}js/rules_list.js"></script>
{% endblock %}

{% block sub_content%}
    {% if rules_list %}
    <h1>Список правил для трэкеров</h1>
    <table class="table table-striped table-condensed vertical-middle">
    <thead>
    <tr>
        <th>ID</th>
        <th>Название</th>
        <th>Тип</th>
        <th>Трэкер</th>
        <th>Инциденты</th>
        <th>Активно</th>
        <th>Даты</th>
        <th>Операции</th>
    </thead>
    <tbody>
    {% for rule in rules_list %}
        <tr{% if not rule.is_active %} class="error"{% endif %}>
            <td><a title="Открыть правило" href="{% url 'edit_rule' rule.id %}">{{ rule.id }}</a></td>
            <td><a title="Открыть правило" href="{% url 'edit_rule' rule.id %}">{{ rule.title }}</a></td>
            <td>{{ rule.get_rule_type_title }}</td>
            <td>{{ rule.device }}</td>
            <td><a href="{% url 'notifications_list' rule.id %}" class="btn btn-sm" title="Список путевых точек"><i class="icon-list"></i> {{ rule.get_count_notifications }}</a></td>
            <td class="rule_icon"><i class="{% if rule.is_active %}icon-ok{% else %}icon-ban-circle{% endif %}"></i></td>
            <td><span class="rule_dates" title="Создано">{{ rule.created_at|date:'Y-m-d H:i:s' }}</span>
            <br><span class="rule_dates activated_at" title="Активировано">{% if rule.activated_at %}{{ rule.activated_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</span>
            <br><span class="rule_dates deactivated_at" title="Выключено">{% if rule.deactivated_at %}{{ rule.deactivated_at_at|date:'Y-m-d H:i:s' }}{% else %}-{% endif %}</span>
            {% if rule.get_last_fire_date %}<br><span class="rule_dates" title="Последний инцидент">{{ rule.get_last_fire_date|date:'Y-m-d H:i:s' }}</span>{% endif %}</td>
            <td class="rule_actions"><input type="button" data-url="{% url 'activate_rule' rule.id %}" class="btn btn-sm btn-block activate_rule" value="{% if rule.is_active %}Выключить{% else %}Активировать{% endif %}">
                <a href="{% url 'edit_rule' rule.id %}" class="btn btn-sm btn-block" title="Редактировать правило">Редактировать</a>
                <a href="{% url 'delete_rule' rule.id %}" class="btn btn-danger btn-sm btn-block" title="Удалить правило">Удалить</a>
        </tr>
    {% endfor %}
    </tbody>
    </table>

    {% if is_paginated %}
    <div class="pagination">
        <a {% if not page_obj.has_previous %}class="disabled"{% endif %} href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}javascript:void(0);{% endif %}">&larr; Назад</a>
        <a {% if not page_obj.has_next %}class="disabled"{% endif %} href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}javascript:void(0);{% endif %}">Вперед &rarr;</a>
        <span class="page-current pull-right">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
    </div>

    {% endif %}
{% else %}
    <h1>Создайте правило для трэкера</h1>
{% endif %}
{% endblock %}